<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用 Vagrant 打造跨平台开发环境 | Ethan</title>
    <meta name="description" content="Vagrant 是一款用来构建虚拟开发环境的工具，非常适合 php/python/ruby/java 这类语言开发 web 应用，“代码在我机子上运行没有问题”这种说辞将成为历史。">
    <link rel="icon" href="/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.5b4dd9a6.css" as="style"><link rel="preload" href="/assets/js/app.98ee12e2.js" as="script"><link rel="preload" href="/assets/js/5.fd13cd00.js" as="script"><link rel="preload" href="/assets/js/3.5d47f0b4.js" as="script"><link rel="preload" href="/assets/js/63.fef78eca.js" as="script"><link rel="preload" href="/assets/js/10.e00da3ba.js" as="script"><link rel="prefetch" href="/assets/js/1.65afdc4c.js"><link rel="prefetch" href="/assets/js/11.fbdad686.js"><link rel="prefetch" href="/assets/js/12.e56fcd63.js"><link rel="prefetch" href="/assets/js/13.ed3e80d4.js"><link rel="prefetch" href="/assets/js/14.586b8530.js"><link rel="prefetch" href="/assets/js/15.4517d850.js"><link rel="prefetch" href="/assets/js/16.fc76481c.js"><link rel="prefetch" href="/assets/js/17.44d26507.js"><link rel="prefetch" href="/assets/js/18.cf12703d.js"><link rel="prefetch" href="/assets/js/19.9dcdf451.js"><link rel="prefetch" href="/assets/js/20.ebf6cc13.js"><link rel="prefetch" href="/assets/js/21.85d3b529.js"><link rel="prefetch" href="/assets/js/22.22f68a8b.js"><link rel="prefetch" href="/assets/js/23.939c3a76.js"><link rel="prefetch" href="/assets/js/24.d37934e8.js"><link rel="prefetch" href="/assets/js/25.a3b984b6.js"><link rel="prefetch" href="/assets/js/26.f8242895.js"><link rel="prefetch" href="/assets/js/27.09a5d5f8.js"><link rel="prefetch" href="/assets/js/28.a2eeca9f.js"><link rel="prefetch" href="/assets/js/29.ff702a7d.js"><link rel="prefetch" href="/assets/js/30.fcc35648.js"><link rel="prefetch" href="/assets/js/31.46c5ef53.js"><link rel="prefetch" href="/assets/js/32.e9e387c8.js"><link rel="prefetch" href="/assets/js/33.f79bfb00.js"><link rel="prefetch" href="/assets/js/34.4d7c6fe9.js"><link rel="prefetch" href="/assets/js/35.9db05073.js"><link rel="prefetch" href="/assets/js/36.cc97cf9b.js"><link rel="prefetch" href="/assets/js/37.8474a991.js"><link rel="prefetch" href="/assets/js/38.d247686d.js"><link rel="prefetch" href="/assets/js/39.69eed42e.js"><link rel="prefetch" href="/assets/js/4.792f2236.js"><link rel="prefetch" href="/assets/js/40.a1aaef7e.js"><link rel="prefetch" href="/assets/js/41.7e10250a.js"><link rel="prefetch" href="/assets/js/42.e4512670.js"><link rel="prefetch" href="/assets/js/43.424227fb.js"><link rel="prefetch" href="/assets/js/44.4fa20a1f.js"><link rel="prefetch" href="/assets/js/45.0d191a82.js"><link rel="prefetch" href="/assets/js/46.c0887ef1.js"><link rel="prefetch" href="/assets/js/47.3f01867b.js"><link rel="prefetch" href="/assets/js/48.73d2336a.js"><link rel="prefetch" href="/assets/js/49.9c2249e9.js"><link rel="prefetch" href="/assets/js/50.b8091276.js"><link rel="prefetch" href="/assets/js/51.63dbfc04.js"><link rel="prefetch" href="/assets/js/52.a07848c4.js"><link rel="prefetch" href="/assets/js/53.d80201cb.js"><link rel="prefetch" href="/assets/js/54.f69c00e8.js"><link rel="prefetch" href="/assets/js/55.1feb89ea.js"><link rel="prefetch" href="/assets/js/56.b88c638f.js"><link rel="prefetch" href="/assets/js/57.98d313be.js"><link rel="prefetch" href="/assets/js/58.05dd3e6d.js"><link rel="prefetch" href="/assets/js/59.9357f097.js"><link rel="prefetch" href="/assets/js/6.c63c9fba.js"><link rel="prefetch" href="/assets/js/60.f59cd3aa.js"><link rel="prefetch" href="/assets/js/61.6fe786ae.js"><link rel="prefetch" href="/assets/js/62.92239f66.js"><link rel="prefetch" href="/assets/js/64.d2f56023.js"><link rel="prefetch" href="/assets/js/65.0936bacc.js"><link rel="prefetch" href="/assets/js/7.c5a3ca43.js"><link rel="prefetch" href="/assets/js/8.4dbe4324.js"><link rel="prefetch" href="/assets/js/9.b1fcbbf6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5b4dd9a6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Ethan" class="logo"> <span class="site-name can-hide">Ethan</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/programming/php/algorithm.html" class="nav-link">PHP</a></li><li class="dropdown-item"><!----> <a href="/programming/python/" class="nav-link">Python</a></li><li class="dropdown-item"><!----> <a href="/programming/web/es6/" class="nav-link">Web</a></li><li class="dropdown-item"><h4>Server</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/server/linux/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/server/docker/" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/server/vagrant/" class="nav-link router-link-exact-active router-link-active">Vagrant</a></li><li class="dropdown-subitem"><a href="/server/mysql/" class="nav-link">Mysql</a></li></ul></li><li class="dropdown-item"><h4>Nosql</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/server/redis/" class="nav-link">Redis</a></li></ul></li><li class="dropdown-item"><h4>Other</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/other/http/" class="nav-link">HTTP</a></li><li class="dropdown-subitem"><a href="/other/git/" class="nav-link">Git</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/tags/" class="nav-link">标签</a></div><div class="nav-item"><a href="/essay/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="https://github.com/JohnMaple" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/programming/php/algorithm.html" class="nav-link">PHP</a></li><li class="dropdown-item"><!----> <a href="/programming/python/" class="nav-link">Python</a></li><li class="dropdown-item"><!----> <a href="/programming/web/es6/" class="nav-link">Web</a></li><li class="dropdown-item"><h4>Server</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/server/linux/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/server/docker/" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/server/vagrant/" class="nav-link router-link-exact-active router-link-active">Vagrant</a></li><li class="dropdown-subitem"><a href="/server/mysql/" class="nav-link">Mysql</a></li></ul></li><li class="dropdown-item"><h4>Nosql</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/server/redis/" class="nav-link">Redis</a></li></ul></li><li class="dropdown-item"><h4>Other</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/other/http/" class="nav-link">HTTP</a></li><li class="dropdown-subitem"><a href="/other/git/" class="nav-link">Git</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/tags/" class="nav-link">标签</a></div><div class="nav-item"><a href="/essay/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="https://github.com/JohnMaple" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Vagrant</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/server/vagrant/" class="active sidebar-link">使用 Vagrant 打造跨平台开发环境</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/server/vagrant/#安装" class="sidebar-link">安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/server/vagrant/#安装virtualbox" class="sidebar-link">安装VirtualBox</a></li><li class="sidebar-sub-header"><a href="/server/vagrant/#安装vagrant" class="sidebar-link">安装Vagrant</a></li></ul></li><li class="sidebar-sub-header"><a href="/server/vagrant/#启动第一台虚拟机" class="sidebar-link">启动第一台虚拟机</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/server/vagrant/#新建一个目录作为-vagrant-的工程目录" class="sidebar-link">新建一个目录作为 Vagrant 的工程目录</a></li><li class="sidebar-sub-header"><a href="/server/vagrant/#初始化镜像" class="sidebar-link">初始化镜像</a></li></ul></li><li class="sidebar-sub-header"><a href="/server/vagrant/#配置浅析" class="sidebar-link">配置浅析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/server/vagrant/#box-名称设置" class="sidebar-link">box 名称设置</a></li><li class="sidebar-sub-header"><a href="/server/vagrant/#hostname-设置" class="sidebar-link">hostname 设置</a></li><li class="sidebar-sub-header"><a href="/server/vagrant/#网络设置" class="sidebar-link">网络设置</a></li><li class="sidebar-sub-header"><a href="/server/vagrant/#同步目录" class="sidebar-link">同步目录</a></li><li class="sidebar-sub-header"><a href="/server/vagrant/#端口转发" class="sidebar-link">端口转发</a></li></ul></li><li class="sidebar-sub-header"><a href="/server/vagrant/#常用命令" class="sidebar-link">常用命令</a></li><li class="sidebar-sub-header"><a href="/server/vagrant/#打包分发" class="sidebar-link">打包分发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/server/vagrant/#打包" class="sidebar-link">打包</a></li><li class="sidebar-sub-header"><a href="/server/vagrant/#分发" class="sidebar-link">分发</a></li></ul></li><li class="sidebar-sub-header"><a href="/server/vagrant/#集成预安装" class="sidebar-link">集成预安装</a></li><li class="sidebar-sub-header"><a href="/server/vagrant/#启动虚拟机集群" class="sidebar-link">启动虚拟机集群</a></li><li class="sidebar-sub-header"><a href="/server/vagrant/#注意事项" class="sidebar-link">注意事项</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="content default"><h1 id="使用-vagrant-打造跨平台开发环境"><a href="#使用-vagrant-打造跨平台开发环境" aria-hidden="true" class="header-anchor">#</a> 使用 Vagrant 打造跨平台开发环境</h1> <p>Vagrant 是一款用来构建虚拟开发环境的工具，非常适合 php/python/ruby/java 这类语言开发 web 应用，“代码在我机子上运行没有问题”这种说辞将成为历史。</p> <p>我们可以通过 Vagrant 封装一个 Linux 的开发环境，分发给团队成员。成员可以在自己喜欢的桌面系统（Mac/Windows/Linux）上开发程序，代码却能统一在封装好的环境里运行。</p> <h2 id="安装"><a href="#安装" aria-hidden="true" class="header-anchor">#</a> 安装</h2> <h3 id="安装virtualbox"><a href="#安装virtualbox" aria-hidden="true" class="header-anchor">#</a> 安装VirtualBox</h3> <p><a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" rel="noopener noreferrer">下载地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="安装vagrant"><a href="#安装vagrant" aria-hidden="true" class="header-anchor">#</a> 安装Vagrant</h3> <p><a href="https://www.vagrantup.com/downloads.html" target="_blank" rel="noopener noreferrer">下载地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="启动第一台虚拟机"><a href="#启动第一台虚拟机" aria-hidden="true" class="header-anchor">#</a> 启动第一台虚拟机</h2> <p>在启动虚拟机之前先简单介绍下 Vagrant box：</p> <ul><li>box 是一个打包好的操作系统，是一个后缀名为 .box 的文件，其实是一个压缩包，里面包含了 Vagrant 的配置信息和 VirtualBox 的虚拟机镜像文件。</li> <li>vagrant up 启动虚拟机是基于 box 文件的，因此在启动虚拟机前必须得把 box 文件准备好。或者也可以在启动的时候指定远程 box 地址，在这里我把 box 文件下载下来，然后启动时指定该文件。
<a href="https://app.vagrantup.com/boxes/search" target="_blank" rel="noopener noreferrer">官方镜像库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="新建一个目录作为-vagrant-的工程目录"><a href="#新建一个目录作为-vagrant-的工程目录" aria-hidden="true" class="header-anchor">#</a> 新建一个目录作为 Vagrant 的工程目录</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">mkdir</span> -p vagrant/project_name
<span class="token function">cd</span> vagrant/project_name
<span class="token function">pwd</span>   <span class="token comment"># ~/vagrant/project_name 目录位置随便</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="初始化镜像"><a href="#初始化镜像" aria-hidden="true" class="header-anchor">#</a> 初始化镜像</h3> <h4 id="本地备好镜像"><a href="#本地备好镜像" aria-hidden="true" class="header-anchor">#</a> 本地备好镜像</h4> <p>一般是基础版的ubuntu，根据你熟悉的操作系统，从镜像库下载下来。</p> <h5 id="添加本地镜像"><a href="#添加本地镜像" aria-hidden="true" class="header-anchor">#</a> 添加本地镜像</h5> <ul><li><code>本地 box 名称</code>：自定义名称，该名称是本地 vagrant 管理时使用的名称；</li> <li><code>box 文件</code>：前面下载的 vagrant box 文件或者远程 box url 地址</li></ul> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># vagrant box add &lt;本地 box 名称&gt; &lt;box 文件&gt;</span>
vagrant box <span class="token function">add</span> ubuntu-server-16.04 ubuntu-server-16.04-amd64-vagrant.box
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="查看镜像"><a href="#查看镜像" aria-hidden="true" class="header-anchor">#</a> 查看镜像</h5> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>vagrant box list
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="tip custom-block"><p>接下来的步骤，参照 <code>使用镜像库初始化</code></p></div> <h4 id="使用镜像库初始化"><a href="#使用镜像库初始化" aria-hidden="true" class="header-anchor">#</a> 使用镜像库初始化</h4> <h5 id="初始化镜像-2"><a href="#初始化镜像-2" aria-hidden="true" class="header-anchor">#</a> 初始化镜像</h5> <p>初始化后会在当前目录生产一个 Vagrantfile 文件，里面包含了虚拟机的各种配置</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># vagrant init &lt;本地 box 名称&gt; </span>
vagrant init <span class="token string">'ubuntu-server-16.04'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p><code>本地 box 名称</code>：若本地没有下好的镜像，默认会从<a href="https://app.vagrantup.com/boxes/search" target="_blank" rel="noopener noreferrer">远程镜像库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>下载</p></blockquote> <h5 id="启动虚拟机"><a href="#启动虚拟机" aria-hidden="true" class="header-anchor">#</a> 启动虚拟机</h5> <p>启动虚拟机时会自动将当前目录（即 Vagrantfile 文件所在目录），和虚拟机的 /vagrant 目录共享</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>vagrant up
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="连接虚拟机"><a href="#连接虚拟机" aria-hidden="true" class="header-anchor">#</a> 连接虚拟机</h5> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>vagrant <span class="token function">ssh</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="查看-vagrant-共享目录"><a href="#查看-vagrant-共享目录" aria-hidden="true" class="header-anchor">#</a> 查看 Vagrant 共享目录</h5> <p>进入虚拟机后执行 <code>df -h</code> 可以看到 Vagrant 默认把宿主机 <code>Vagrantfile</code> 所在的目录和虚拟机的 <code>/vagrant</code> 目录共享，可以通过 <code>ls /vagrant/</code> 查看该目录内容，内容和宿主机对应目录一致</p> <h2 id="配置浅析"><a href="#配置浅析" aria-hidden="true" class="header-anchor">#</a> 配置浅析</h2> <p>Vagrantfile 主要包括三个方面的配置，虚拟机的配置、SSH配置、Vagrant 的一些基础配置。Vagrant 是使用 Ruby 开发的，所以它的配置语法也是 Ruby 的，对于没有学过 Ruby 的朋友也没关系，根据例子模仿下就会了。</p> <blockquote><p>修改完配置后需要执行 <code>vagrant reload</code> 重启 VM 使其配置生效</p></blockquote> <h3 id="box-名称设置"><a href="#box-名称设置" aria-hidden="true" class="header-anchor">#</a> box 名称设置</h3> <p><code>config.vm.box = &quot;centos7&quot;</code></p> <p>该名称是再使用 vagrant init 中后面跟的名字，那么默认就是 base。</p> <h3 id="hostname-设置"><a href="#hostname-设置" aria-hidden="true" class="header-anchor">#</a> hostname 设置</h3> <p><code>config.vm.hostname = &quot;node1&quot;</code></p> <p>设置hostname非常重要，因为当我们有很多台虚拟服务器的时候，都是依靠hostname來做识别的。比如，我安装了centos1,centos2 两台虚拟机，再启动时，我可以通过vagrant up centos1来指定只启动哪一台。</p> <h3 id="网络设置"><a href="#网络设置" aria-hidden="true" class="header-anchor">#</a> 网络设置</h3> <p>agrant 有两种方式来进行网络连接：</p> <ul><li><code>NAT</code> : 缺省创建，用于让vm可以通过host转发访问局域网甚至互联网。</li> <li><code>host-only (主机模式)</code>：这种模式下所有的虚拟系统是可以互相通信的，但虚拟系统和真实的网络是被隔离开的，虚拟机和宿主机是可以互相通信的，相当于两台机器通过双绞线互联。</li> <li><code>Bridge(桥接模式)</code>：该模式下的 VM 就像是局域网中的一台独立的主机，可以和局域网中的任何一台机器通信，这种情况下需要手动给 VM 配 IP 地址，子网掩码等。</li></ul> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token comment"># Host-only模式</span>
config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">&quot;private_network&quot;</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">&quot;192.168.10.11&quot;</span>

<span class="token comment"># Bridge模式</span>
config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">&quot;public_network&quot;</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">&quot;10.1.2.61&quot;</span>

<span class="token comment"># Host-only模式下，ip不指定，采用dhcp</span>
<span class="token comment"># config.vm.network &quot;private_network&quot;, type: &quot;dhcp”</span>

<span class="token comment"># 创建一个bridge桥接网络，指定IP</span>
<span class="token comment"># config.vm.network &quot;public_network&quot;, ip: &quot;192.168.0.17&quot;</span>
<span class="token comment"># 创建一个bridge桥接网络，指定桥接适配器</span>
<span class="token comment"># config.vm.network &quot;public_network&quot;, bridge: &quot;en1: Wi-Fi (AirPort)&quot;</span>
<span class="token comment"># 创建一个bridge桥接网络，不指定桥接适配器</span>
<span class="token comment"># config.vm.network &quot;public_network&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="同步目录"><a href="#同步目录" aria-hidden="true" class="header-anchor">#</a> 同步目录</h3> <p>前面介绍过/vagrant目录默认就是当前的开发目录，这是在虚拟机开启的时候默认挂载同步的。还可以通过配置来设置额外的同步目录</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token comment"># 第一个参数是主机的目录，第二个参数是虚拟机挂载的目录</span>
config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>synced_folder  <span class="token string">&quot;/Users/haohao/data&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/vagrant_data&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="端口转发"><a href="#端口转发" aria-hidden="true" class="header-anchor">#</a> 端口转发</h3> <p>对宿主机器上 8080 端口的访问请求 forward 到虚拟机的 80 端口的服务上</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token symbol">:forwarded_port</span><span class="token punctuation">,</span> guest<span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span> host<span class="token punctuation">:</span> <span class="token number">8080</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="常用命令"><a href="#常用命令" aria-hidden="true" class="header-anchor">#</a> 常用命令</h2> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ vagrant init  <span class="token comment"># 初始化</span>
$ vagrant up  <span class="token comment"># 启动虚拟机</span>
$ vagrant <span class="token function">halt</span>  <span class="token comment"># 关闭虚拟机</span>
$ vagrant reload  <span class="token comment"># 重启虚拟机，重新载入配置文件</span>
$ vagrant <span class="token function">ssh</span>  <span class="token comment"># 登录虚拟机</span>
$ vagrant status  <span class="token comment"># 查看虚拟机运行状态</span>
$ vagrant destroy  <span class="token comment"># 销毁当前虚拟机</span>
$ vagrant box list  <span class="token comment"># 列出 Vagrant 当前 box 列表</span>
$ vagrant box remove  <span class="token comment"># 删除相应的 box</span>
$ vagrant package  <span class="token comment"># 把当前的运行的虚拟机环境进行打包为 box 文件，vagrant package --output xxx.box</span>
$ vagrant plugin  <span class="token comment"># 安装卸载插件</span>
$ vagrant resume  <span class="token comment"># 恢复被挂起的状态</span>
$ vagrant status  <span class="token comment"># 获取当前虚拟机的状态</span>
$ vagrant <span class="token function">suspend</span>  <span class="token comment"># 挂起当前的虚拟机</span>
$ vagrant global-status  <span class="token comment"># 查看当前 vagrant 管理的所有 vm 信息</span>
$ vagrant ssh-config  <span class="token comment"># 输出用于 ssh 连接的一些信息</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="打包分发"><a href="#打包分发" aria-hidden="true" class="header-anchor">#</a> 打包分发</h2> <h3 id="打包"><a href="#打包" aria-hidden="true" class="header-anchor">#</a> 打包</h3> <p>在当前目录下，使用vagrant package打包，生成 <code>.box</code> 镜像文件</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ vagrant package
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="分发"><a href="#分发" aria-hidden="true" class="header-anchor">#</a> 分发</h3> <p>打包好的 <code>.box</code> 文件分发给别人，其他人执行下面命令，就可以得到一模一样的开发环境了</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ vagrant box <span class="token function">add</span> vnmp ~/box/package.box  <span class="token comment"># 添加 package.box 镜像并命名为 vnmp</span>
$ <span class="token function">cd</span> ~/dev  <span class="token comment"># 切换到项目目录</span>
$ vagrant init vnmp  <span class="token comment"># 用 vnmp 镜像初始化。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="集成预安装"><a href="#集成预安装" aria-hidden="true" class="header-anchor">#</a> 集成预安装</h2> <p>从上面这条看下来，你会发现每次都修改了一点点内容，再打包分发给其他用户其实很麻烦。为此 Vagrant 还提供了更为便捷的预安装定制。打开 <code>Vagrantfile</code> 文件末尾处有下面被注释的代码:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>provision <span class="token string">&quot;shell&quot;</span><span class="token punctuation">,</span> inline<span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token operator">&lt;</span><span class="token operator">-</span><span class="token constant">SHELL</span>
   apt<span class="token operator">-</span>get update
   apt<span class="token operator">-</span>get install <span class="token operator">-</span>y apache2
<span class="token constant">SHELL</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这段代码就是让你在初次运行 vagrant up 后，虚拟机创建过程众自动运行的初始化命令。 取消注释，把要预先安装的 php/mysql/redis 和配置之类的通通都写进去。初始化时这些程序都会根据你写好的方法安装并配置。</p> <p>如果你不是初次运行，同时又修改了这里的命令，想让系统再次运行这里面的命令，你可以使用 <code>vagrant reload --provision</code> 进行重载。所以在这种情况下，你只要将 <code>Vagrantfile</code> 共享给团队的其他成员就可以了，其他成员运行相同的命令即可，是不是比打包分发要方便许多。</p> <p>你还可以把要运行的命令单独写在一个文件里存放在相同的目录下，比如 bootstrap.sh：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">#!/usr/bin/env bash</span>

<span class="token function">apt-get</span> update
<span class="token function">apt-get</span> <span class="token function">install</span> -y apache2
<span class="token keyword">if</span> <span class="token operator">!</span> <span class="token punctuation">[</span> -L /var/www <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token function">rm</span> -rf /var/www
  <span class="token function">ln</span> -fs /vagrant /var/www
<span class="token keyword">fi</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>然后在 Vagrantfile 里这样添加：</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token constant">Vagrant</span><span class="token punctuation">.</span>configure<span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>box <span class="token operator">=</span> <span class="token string">&quot;hashicorp/precise64&quot;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>provision <span class="token string">&quot;shell&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token string">&quot;bootstrap.sh&quot;</span>  <span class="token comment"># 添加这行</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>效果和直接写在 Vagrantfile 是一样的。</p> <h2 id="启动虚拟机集群"><a href="#启动虚拟机集群" aria-hidden="true" class="header-anchor">#</a> 启动虚拟机集群</h2> <p>前面我们都是通过一个 Vagrantfile 配置启动单台机器，如果我们要启动一个集群，那么可以把需要的节点在一个 Vagrantfile 写好，然后直接就可以通过 vagrant up 同时启动多个 VM 组成一个集群。以下示例配置一个 web 节点和一个 db 节点，两个节点在同一个网段，并且使用同一个 box 启动：</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token constant">Vagrant</span><span class="token punctuation">.</span>configure<span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>define <span class="token symbol">:web</span> <span class="token keyword">do</span> <span class="token operator">|</span>web<span class="token operator">|</span>
    web<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>provider <span class="token string">&quot;virtualbox&quot;</span> <span class="token keyword">do</span> <span class="token operator">|</span>v<span class="token operator">|</span>
          v<span class="token punctuation">.</span>customize <span class="token punctuation">[</span><span class="token string">&quot;modifyvm&quot;</span><span class="token punctuation">,</span> <span class="token symbol">:id</span><span class="token punctuation">,</span> <span class="token string">&quot;--name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;web&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;--memory&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;512&quot;</span><span class="token punctuation">]</span>
    <span class="token keyword">end</span>
    web<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>box <span class="token operator">=</span> <span class="token string">&quot;ubuntu-server-16.04&quot;</span>
    web<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>hostname <span class="token operator">=</span> <span class="token string">&quot;web&quot;</span>
    web<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token symbol">:private_network</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">&quot;11.11.1.1&quot;</span>
  <span class="token keyword">end</span>

  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>define <span class="token symbol">:db</span> <span class="token keyword">do</span> <span class="token operator">|</span>db<span class="token operator">|</span>
    db<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>provider <span class="token string">&quot;virtualbox&quot;</span> <span class="token keyword">do</span> <span class="token operator">|</span>v<span class="token operator">|</span>
          v<span class="token punctuation">.</span>customize <span class="token punctuation">[</span><span class="token string">&quot;modifyvm&quot;</span><span class="token punctuation">,</span> <span class="token symbol">:id</span><span class="token punctuation">,</span> <span class="token string">&quot;--name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;db&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;--memory&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;512&quot;</span><span class="token punctuation">]</span>
    <span class="token keyword">end</span>
    db<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>box <span class="token operator">=</span> <span class="token string">&quot;ubuntu-server-16.04&quot;</span>
    db<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>hostname <span class="token operator">=</span> <span class="token string">&quot;db&quot;</span>
    db<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token symbol">:private_network</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">&quot;11.11.1.2&quot;</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="注意事项"><a href="#注意事项" aria-hidden="true" class="header-anchor">#</a> 注意事项</h2> <p>使用 Apache/Nginx 时会出现诸如图片修改后但页面刷新仍然是旧文件的情况，是由于 VirtualBox 的一个 BUG 造成的。需要对虚拟机里的 Apache/Nginx 配置文件进行修改：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># Apache 配置（httpd.conf 或者 apache.conf）修改：</span>
EnableSendfile off

<span class="token comment"># Nginx 配置（nginx.conf）修改：</span>
sendfile off<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">1 天前</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/server/docker/docker-compose.html" class="prev">docker-compose编排容器</a></span> <span class="next"><a href="/server/mysql/">Mysql常见存储引擎 -- MyISAM和InnoDB的区别</a>→
      </span></p></div>  <div class="vcomment"><div id="vcomments"></div></div></main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.98ee12e2.js" defer></script><script src="/assets/js/5.fd13cd00.js" defer></script><script src="/assets/js/3.5d47f0b4.js" defer></script><script src="/assets/js/63.fef78eca.js" defer></script><script src="/assets/js/10.e00da3ba.js" defer></script>
  </body>
</html>
