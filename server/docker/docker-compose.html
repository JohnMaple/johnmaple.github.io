<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>docker-compose编排容器 | Ethan</title>
    <meta name="description" content="Docker Compose 是 Docker 容器进行编排的工具，定义和运行多容器的应用，可以一条命令启动多个容器。">
    <link rel="icon" href="/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.5b4dd9a6.css" as="style"><link rel="preload" href="/assets/js/app.98ee12e2.js" as="script"><link rel="preload" href="/assets/js/5.fd13cd00.js" as="script"><link rel="preload" href="/assets/js/3.5d47f0b4.js" as="script"><link rel="preload" href="/assets/js/48.73d2336a.js" as="script"><link rel="preload" href="/assets/js/10.e00da3ba.js" as="script"><link rel="prefetch" href="/assets/js/1.65afdc4c.js"><link rel="prefetch" href="/assets/js/11.fbdad686.js"><link rel="prefetch" href="/assets/js/12.e56fcd63.js"><link rel="prefetch" href="/assets/js/13.ed3e80d4.js"><link rel="prefetch" href="/assets/js/14.586b8530.js"><link rel="prefetch" href="/assets/js/15.4517d850.js"><link rel="prefetch" href="/assets/js/16.fc76481c.js"><link rel="prefetch" href="/assets/js/17.44d26507.js"><link rel="prefetch" href="/assets/js/18.cf12703d.js"><link rel="prefetch" href="/assets/js/19.9dcdf451.js"><link rel="prefetch" href="/assets/js/20.ebf6cc13.js"><link rel="prefetch" href="/assets/js/21.85d3b529.js"><link rel="prefetch" href="/assets/js/22.22f68a8b.js"><link rel="prefetch" href="/assets/js/23.939c3a76.js"><link rel="prefetch" href="/assets/js/24.d37934e8.js"><link rel="prefetch" href="/assets/js/25.a3b984b6.js"><link rel="prefetch" href="/assets/js/26.f8242895.js"><link rel="prefetch" href="/assets/js/27.09a5d5f8.js"><link rel="prefetch" href="/assets/js/28.a2eeca9f.js"><link rel="prefetch" href="/assets/js/29.ff702a7d.js"><link rel="prefetch" href="/assets/js/30.fcc35648.js"><link rel="prefetch" href="/assets/js/31.46c5ef53.js"><link rel="prefetch" href="/assets/js/32.e9e387c8.js"><link rel="prefetch" href="/assets/js/33.f79bfb00.js"><link rel="prefetch" href="/assets/js/34.4d7c6fe9.js"><link rel="prefetch" href="/assets/js/35.9db05073.js"><link rel="prefetch" href="/assets/js/36.cc97cf9b.js"><link rel="prefetch" href="/assets/js/37.8474a991.js"><link rel="prefetch" href="/assets/js/38.d247686d.js"><link rel="prefetch" href="/assets/js/39.69eed42e.js"><link rel="prefetch" href="/assets/js/4.792f2236.js"><link rel="prefetch" href="/assets/js/40.a1aaef7e.js"><link rel="prefetch" href="/assets/js/41.7e10250a.js"><link rel="prefetch" href="/assets/js/42.e4512670.js"><link rel="prefetch" href="/assets/js/43.424227fb.js"><link rel="prefetch" href="/assets/js/44.4fa20a1f.js"><link rel="prefetch" href="/assets/js/45.0d191a82.js"><link rel="prefetch" href="/assets/js/46.c0887ef1.js"><link rel="prefetch" href="/assets/js/47.3f01867b.js"><link rel="prefetch" href="/assets/js/49.9c2249e9.js"><link rel="prefetch" href="/assets/js/50.b8091276.js"><link rel="prefetch" href="/assets/js/51.63dbfc04.js"><link rel="prefetch" href="/assets/js/52.a07848c4.js"><link rel="prefetch" href="/assets/js/53.d80201cb.js"><link rel="prefetch" href="/assets/js/54.f69c00e8.js"><link rel="prefetch" href="/assets/js/55.1feb89ea.js"><link rel="prefetch" href="/assets/js/56.b88c638f.js"><link rel="prefetch" href="/assets/js/57.98d313be.js"><link rel="prefetch" href="/assets/js/58.05dd3e6d.js"><link rel="prefetch" href="/assets/js/59.9357f097.js"><link rel="prefetch" href="/assets/js/6.c63c9fba.js"><link rel="prefetch" href="/assets/js/60.f59cd3aa.js"><link rel="prefetch" href="/assets/js/61.6fe786ae.js"><link rel="prefetch" href="/assets/js/62.92239f66.js"><link rel="prefetch" href="/assets/js/63.fef78eca.js"><link rel="prefetch" href="/assets/js/64.d2f56023.js"><link rel="prefetch" href="/assets/js/65.0936bacc.js"><link rel="prefetch" href="/assets/js/7.c5a3ca43.js"><link rel="prefetch" href="/assets/js/8.4dbe4324.js"><link rel="prefetch" href="/assets/js/9.b1fcbbf6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5b4dd9a6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Ethan" class="logo"> <span class="site-name can-hide">Ethan</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/programming/php/algorithm.html" class="nav-link">PHP</a></li><li class="dropdown-item"><!----> <a href="/programming/python/" class="nav-link">Python</a></li><li class="dropdown-item"><!----> <a href="/programming/web/es6/" class="nav-link">Web</a></li><li class="dropdown-item"><h4>Server</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/server/linux/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/server/docker/" class="nav-link router-link-active">Docker</a></li><li class="dropdown-subitem"><a href="/server/vagrant/" class="nav-link">Vagrant</a></li><li class="dropdown-subitem"><a href="/server/mysql/" class="nav-link">Mysql</a></li></ul></li><li class="dropdown-item"><h4>Nosql</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/server/redis/" class="nav-link">Redis</a></li></ul></li><li class="dropdown-item"><h4>Other</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/other/http/" class="nav-link">HTTP</a></li><li class="dropdown-subitem"><a href="/other/git/" class="nav-link">Git</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/tags/" class="nav-link">标签</a></div><div class="nav-item"><a href="/essay/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="https://github.com/JohnMaple" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/programming/php/algorithm.html" class="nav-link">PHP</a></li><li class="dropdown-item"><!----> <a href="/programming/python/" class="nav-link">Python</a></li><li class="dropdown-item"><!----> <a href="/programming/web/es6/" class="nav-link">Web</a></li><li class="dropdown-item"><h4>Server</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/server/linux/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/server/docker/" class="nav-link router-link-active">Docker</a></li><li class="dropdown-subitem"><a href="/server/vagrant/" class="nav-link">Vagrant</a></li><li class="dropdown-subitem"><a href="/server/mysql/" class="nav-link">Mysql</a></li></ul></li><li class="dropdown-item"><h4>Nosql</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/server/redis/" class="nav-link">Redis</a></li></ul></li><li class="dropdown-item"><h4>Other</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/other/http/" class="nav-link">HTTP</a></li><li class="dropdown-subitem"><a href="/other/git/" class="nav-link">Git</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/tags/" class="nav-link">标签</a></div><div class="nav-item"><a href="/essay/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="https://github.com/JohnMaple" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Docker</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/server/docker/" class="sidebar-link">Docker 基本命令汇总</a></li><li><a href="/server/docker/dockerfile.html" class="sidebar-link">Dockerfile 介绍</a></li><li><a href="/server/docker/docker-compose.html" class="active sidebar-link">docker-compose编排容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#安装compose" class="sidebar-link">安装compose</a></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#compose-常用命令与配置" class="sidebar-link">compose 常用命令与配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#build" class="sidebar-link">build</a></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#help" class="sidebar-link">help</a></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#kill" class="sidebar-link">kill</a></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#config" class="sidebar-link">config</a></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#exec" class="sidebar-link">exec</a></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#ps" class="sidebar-link">ps</a></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#logs" class="sidebar-link">logs</a></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#port" class="sidebar-link">port</a></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#pull" class="sidebar-link">pull</a></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#push" class="sidebar-link">push</a></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#up" class="sidebar-link">up</a></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#start" class="sidebar-link">start</a></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#stop" class="sidebar-link">stop</a></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#restart" class="sidebar-link">restart</a></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#run" class="sidebar-link">run</a></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#rm" class="sidebar-link">rm</a></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#scale" class="sidebar-link">scale</a></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#version" class="sidebar-link">version</a></li></ul></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#docker-compose-yml-属性" class="sidebar-link">docker-compose.yml 属性</a></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#其他" class="sidebar-link">其他</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#更新容器" class="sidebar-link">更新容器</a></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#links" class="sidebar-link">links</a></li></ul></li><li class="sidebar-sub-header"><a href="/server/docker/docker-compose.html#示例" class="sidebar-link">示例</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vagrant</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="content default"><h1 id="使用docker-compose编排容器"><a href="#使用docker-compose编排容器" aria-hidden="true" class="header-anchor">#</a> 使用docker-compose编排容器</h1> <p>docker-compose 是 Docker 容器进行编排的工具，定义和运行多容器的应用，可以一条命令启动多个容器。
使用Compose 基本上分为三步：</p> <ul><li>Dockerfile 定义应用的运行环境</li> <li>docker-compose.yml 定义组成应用的各服务</li> <li>docker-compose up 启动整个应用</li></ul> <h2 id="安装compose"><a href="#安装compose" aria-hidden="true" class="header-anchor">#</a> 安装compose</h2> <p>安装 Docker Compose 可以通过下面命令自动下载适应版本的 Compose，并为安装脚本添加执行权限</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">sudo</span> <span class="token function">curl</span> -L https://github.com/docker/compose/releases/download/1.21.2/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -s<span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -m<span class="token variable">)</span></span> -o /usr/local/bin/docker-compose
<span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>查看安装是否成功</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>docker-compose --version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="compose-常用命令与配置"><a href="#compose-常用命令与配置" aria-hidden="true" class="header-anchor">#</a> compose 常用命令与配置</h2> <h3 id="build"><a href="#build" aria-hidden="true" class="header-anchor">#</a> build</h3> <p>构建或重新构建服务容器</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># docker-compose build [options] [--build-arg key=val...] [SERVICE...]</span>
docker-compose build
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>选项：</p> <ul><li><code>–compress</code> 通过gzip压缩构建上下环境</li> <li><code>–force-rm</code> 删除构建过程中的临时容器</li> <li><code>–no-cache</code> 构建镜像过程中不使用缓存</li> <li><code>–pull</code> 始终尝试通过拉取操作来获取更新版本的镜像</li> <li><code>-m</code>, <code>--memory MEM</code> 为构建的容器设置内存大小</li> <li><code>–build-arg key=val</code> 为服务设置build-time变量</li></ul> <h3 id="help"><a href="#help" aria-hidden="true" class="header-anchor">#</a> help</h3> <p>获得一个命令的帮助</p> <h3 id="kill"><a href="#kill" aria-hidden="true" class="header-anchor">#</a> kill</h3> <p>通过发送 SIGKILL 信号来停止指定服务的容器</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># docker-compose kill [options] [SERVICE...]</span>
docker-compose <span class="token function">kill</span> -s SIGINT   <span class="token comment"># -s参数来指定发送的信号，例如发送SIGINT信号</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="config"><a href="#config" aria-hidden="true" class="header-anchor">#</a> config</h3> <p>验证并查看compose文件配置</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># docker-compose config [options]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>选项：</p> <ul><li><code>–resolve-image-digests</code> 将镜像标签标记为摘要</li> <li><code>-q</code>, <code>--quiet</code> 只验证配置，不输出。 当配置正确时，不输出任何内容，当文件配置错误，输出错误信息</li> <li><code>–services</code> 打印服务名，一行一个</li> <li><code>–volumes</code> 打印数据卷名，一行一个</li></ul> <h3 id="exec"><a href="#exec" aria-hidden="true" class="header-anchor">#</a> exec</h3> <p>与 <code>docker exec</code> 命令功能相同，可以通过service name登陆到容器中</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># docker exec [options] SERVICE COMMAND [ARGS...]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>选项：</p> <ul><li><code>-d</code> 分离模式，后台运行命令</li> <li><code>–privileged</code> 获取特权</li> <li><code>–user USER</code> 指定运行的用户</li> <li><code>-T</code> 禁用分配TTY. By default docker-compose exec分配 a TTY</li> <li><code>–index=index</code> 当一个服务拥有多个容器时，可通过该参数登陆到该服务下的任何服务，例如：docker-compose exec --index=1 web /bin/bash ，web服务中包含多个容器</li></ul> <h3 id="ps"><a href="#ps" aria-hidden="true" class="header-anchor">#</a> ps</h3> <p>列出所有运行容器</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># docker-compose ps [options] [SERVICE...]</span>
docker-compose <span class="token function">ps</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>选项：</p> <ul><li><code>-q</code> 只打印容器的ID信息</li></ul> <h3 id="logs"><a href="#logs" aria-hidden="true" class="header-anchor">#</a> logs</h3> <p>查看服务日志输出</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># docker-compose logs [options] [SERVICE...]</span>
docker-compose logs
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>docker-compose将对不同的服务输出使用不同的颜色来区分。可以通过–no-color来关闭颜色</p> <h3 id="port"><a href="#port" aria-hidden="true" class="header-anchor">#</a> port</h3> <p>打印某个容器端口所映射的公共端口</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># docker-compose port [options] SERVICE PRIVATE_PORT</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>选项：</p> <ul><li><code>–protocol=proto</code> 指定端口协议，TCP（默认值）或者UDP</li> <li><code>–index=index</code> 如果同意服务存在多个容器，指定命令对象容器的序号（默认为1）</li></ul> <h3 id="pull"><a href="#pull" aria-hidden="true" class="header-anchor">#</a> pull</h3> <p>拉取服务依赖的镜像</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># docker-compose pull [options] [SERVICE...]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>选项：</p> <ul><li><code>–ignore-pull-failures</code> 忽略拉取镜像过程中的错误</li> <li><code>–parallel</code> 多个镜像同时拉取</li> <li><code>–quiet</code> 拉取镜像过程中不打印进度信息</li></ul> <h3 id="push"><a href="#push" aria-hidden="true" class="header-anchor">#</a> push</h3> <p>推送服务依赖的镜像</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># docker-compose push [options] [SERVICE...]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>选项：</p> <ul><li><code>–ignore-pull-failures</code> 忽略拉取镜像过程中的错误</li></ul> <h3 id="up"><a href="#up" aria-hidden="true" class="header-anchor">#</a> up</h3> <p>up命令十分强大，它尝试自动完成包括构建镜像，（重新）创建服务，启动服务，并关联服务相关容器的一些列操作。链接的服务都将会被自动启动，除非已经处于运行状态。
多数情况下我们可以直接通过该命令来启动一个项目</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># docker-compose up [options] [--scale SERVICE=NUM...] [SERVICE...]</span>
docker-compose up
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>选项：</p> <ul><li><code>-d</code> 在后台运行服务容器</li> <li><code>–no-color</code> 不使用颜色来区分不同的服务的控制输出</li> <li><code>–no-deps</code> 不启动服务所链接的容器</li> <li><code>–force-recreate</code> 强制重新创建容器，不能与 <code>–no-recreate</code>同时使用</li> <li><code>–no-recreate</code> 如果容器已经存在，则不重新创建，不能与 <code>–force-recreate</code> 同时使用</li> <li><code>–no-build</code> 不自动构建缺失的服务镜像</li> <li><code>–build</code> 在启动容器前构建服务镜像</li> <li><code>–abort-on-container-exit</code> 停止所有容器，如果任何一个容器被停止，不能与-d同时使用</li> <li><code>-t</code>, <code>--timeout TIMEOUT</code> 停止容器时候的超时（默认为10秒）</li> <li><code>–remove-orphans</code> 删除服务中没有在compose文件中定义的容器</li> <li><code>–scale SERVICE=NUM</code> 设置服务运行容器的个数，将覆盖在compose中通过scale指定的参数</li></ul> <h3 id="start"><a href="#start" aria-hidden="true" class="header-anchor">#</a> start</h3> <p>启动已经存在的服务容器</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># docker-compose start [SERVICE...]</span>
docker-compose start dnmp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="stop"><a href="#stop" aria-hidden="true" class="header-anchor">#</a> stop</h3> <p>停止已经处于运行状态的容器，但不删除它</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># docker-compose stop [options] [SERVICE...]</span>
docker-compose start dnmp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>选项：</p> <ul><li><code>-t</code>, <code>--timeout TIMEOUT</code> 停止容器时候的超时（默认为10秒）</li></ul> <h3 id="restart"><a href="#restart" aria-hidden="true" class="header-anchor">#</a> restart</h3> <p>重启项目中的服务</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># docker-compose restart [options] [SERVICE...]</span>
docker-compose restart dnmp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>选项：</p> <ul><li><code>-t</code>, <code>--timeout TIMEOUT</code> 指定重启前停止容器的超时（默认为10秒）</li></ul> <h3 id="run"><a href="#run" aria-hidden="true" class="header-anchor">#</a> run</h3> <p>在指定服务上执行一个命令</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># docker-compose run [options] [-v VOLUME...] [-p PORT...] [-e KEY=VAL...] SERVICE [COMMAND] [ARGS...]</span>
docker-compose run ubuntu <span class="token function">ping</span> www.anumbrella.net   <span class="token comment"># 将会执行一个ubuntu容器，并执行ping www.anumbrella.net命令。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>默认情况下，如果存在关联，则所有关联的服务将会自动被启动，除非这些服务已经在运行中。该命令类似于启动容器后运行指定的命令，相关卷、链接等都会按照配置自动创建。有两个不同点：</p> <ul><li>给定命令将会覆盖原有的自动运行命令</li> <li>不会自动创建端口，以避免冲突</li></ul></blockquote> <p>如果不希望自动启动关联的容器，可以使用–no-deps选项，例如：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>docker-compose run --no-deps web
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>选项：</p> <ul><li><code>-d</code> 在后台运行服务容器</li> <li><code>–name NAME</code> 为容器指定一个名字</li> <li><code>–entrypoint CMD</code> 覆盖默认的容器启动指令</li> <li><code>-e KEY=VAL</code> 设置环境变量值，可多次使用选项来设置多个环境变量</li> <li><code>-u</code>, <code>--user=&quot;&quot;</code> 指定运行容器的用户名或者uid</li> <li><code>–no-deps</code> 不自动启动管理的服务容器</li> <li><code>–rm</code> 运行命令后自动删除容器，d模式下将忽略</li> <li><code>-p</code>, <code>--publish=[]</code> 映射容器端口到本地主机</li> <li><code>–service-ports</code> 配置服务端口并映射到本地主机</li> <li><code>-v</code>, <code>--volume=[]</code> 绑定一个数据卷，默认为空</li> <li><code>-T</code> 不分配伪tty，意味着依赖tty的指令将无法运行</li> <li><code>-w</code>, <code>--workdir=&quot;&quot;</code> 为容器指定默认工作目录</li></ul> <h3 id="rm"><a href="#rm" aria-hidden="true" class="header-anchor">#</a> rm</h3> <p>删除指定服务的容器</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># docker-compose rm [options] [SERVICE...]</span>
docker-compose <span class="token function">rm</span> dnmp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>选项：</p> <ul><li><code>–f</code>, <code>--force</code> 强制直接删除，包括非停止状态的容器</li> <li><code>-v</code> 删除容器所挂载的数据卷</li></ul> <h3 id="scale"><a href="#scale" aria-hidden="true" class="header-anchor">#</a> scale</h3> <p>设置指定服务运行的容器个数，通过service=num的参数来设置数量</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># docker-compose scale [options] [SERVICE=NUM...]</span>
docker-compose scale web<span class="token operator">=</span>3 db<span class="token operator">=</span>2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>将启动3个容器运行web服务，2个容器运行db服务。一般情况下，当指定书目多于该服务当前实际运行容器，将新创建并启动容器；反之，将停止容器。</p> <p>选项：</p> <ul><li><code>-t</code>, <code>--timeout TIMEOUT</code> 停止容器时候的超时（默认为10秒）</li></ul> <h3 id="version"><a href="#version" aria-hidden="true" class="header-anchor">#</a> version</h3> <p>打印版本信息</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>docker-compose version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="docker-compose-yml-属性"><a href="#docker-compose-yml-属性" aria-hidden="true" class="header-anchor">#</a> docker-compose.yml 属性</h2> <ul><li><code>version</code>：指定 docker-compose.yml 文件的写法格式</li> <li><code>services</code>：多个容器集合</li> <li><code>build</code>：配置构建时，Compose 会利用它自动构建镜像，该值可以是一个路径，也可以是一个对象，用于指定 Dockerfile 参数<div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">build</span><span class="token punctuation">:</span> ./dir
<span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span>
<span class="token key atrule">build</span><span class="token punctuation">:</span>
    <span class="token key atrule">context</span><span class="token punctuation">:</span> ./dir
    <span class="token key atrule">dockerfile</span><span class="token punctuation">:</span> Dockerfile
    <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token key atrule">buildno</span><span class="token punctuation">:</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><code>command</code>：覆盖容器启动后默认执行的命令<div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">command</span><span class="token punctuation">:</span> bundle exec thin <span class="token punctuation">-</span>p 3000
<span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">-</span>
<span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>bundle<span class="token punctuation">,</span>exec<span class="token punctuation">,</span>thin<span class="token punctuation">,</span><span class="token punctuation">-</span>p<span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><code>dns</code>：配置 dns 服务器，可以是一个值或列表<div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">dns</span><span class="token punctuation">:</span> 8.8.8.8
<span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span>
<span class="token key atrule">dns</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> 8.8.8.8
    <span class="token punctuation">-</span> 9.9.9.9
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><code>dns_search</code>：配置 DNS 搜索域，可以是一个值或列表<div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">dns_search</span><span class="token punctuation">:</span> example.com
<span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span>
<span class="token key atrule">dns_search</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> dc1.example.com
    <span class="token punctuation">-</span> dc2.example.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><code>environment</code>：环境变量配置，可以用数组或字典两种方式<div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">environment</span><span class="token punctuation">:</span>
  <span class="token key atrule">RACK_ENV</span><span class="token punctuation">:</span> development
  <span class="token key atrule">SHOW</span><span class="token punctuation">:</span> <span class="token string">'ture'</span>
<span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">-</span>
<span class="token key atrule">environment</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> RACK_ENV=development
    <span class="token punctuation">-</span> SHOW=ture
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><code>env_file</code>：从文件中获取环境变量，可以指定一个文件路径或路径列表，其优先级低于 <code>environment</code> 指定的环境变量<div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">env_file</span><span class="token punctuation">:</span> .env
<span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">---</span>
<span class="token key atrule">env_file</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ./common.env
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><code>expose</code>：暴露端口，只将端口暴露给连接的服务，而不暴露给主机<div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">expose</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">&quot;3000&quot;</span>
  <span class="token punctuation">-</span> <span class="token string">&quot;8000&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><code>image</code>：指定服务所使用的镜像<div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><code>network_mode</code>：设置网络模式<div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">&quot;bridge&quot;</span>
<span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">&quot;host&quot;</span>
<span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">&quot;none&quot;</span>
<span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">&quot;service:[service name]&quot;</span>
<span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">&quot;container:[container name/id]&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><code>ports</code>：对外暴露的端口定义，和 <code>expose</code> 对应<div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">ports</span><span class="token punctuation">:</span>   <span class="token comment"># 暴露端口信息  - &quot;宿主机端口:容器暴露端口&quot;</span>
  <span class="token punctuation">-</span> <span class="token string">&quot;8763:8763&quot;</span>
  <span class="token punctuation">-</span> &quot;8763<span class="token punctuation">:</span><span class="token number">8763</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><code>links</code>：将指定容器连接到当前连接，可以设置别名，避免ip方式导致的容器重启动态改变的无法连接情况<div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">links</span><span class="token punctuation">:</span>    <span class="token comment"># 指定服务名称:别名 </span>
  <span class="token punctuation">-</span> docker<span class="token punctuation">-</span>compose<span class="token punctuation">-</span>eureka<span class="token punctuation">-</span>server<span class="token punctuation">:</span>compose<span class="token punctuation">-</span>eureka
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><code>volumes</code>：卷挂载路径<div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> /lib
  <span class="token punctuation">-</span> /var
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><code>logs</code>：日志输出信息<div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>color          单色输出，不显示其他颜.
<span class="token punctuation">-</span>f<span class="token punctuation">,</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>follow        跟踪日志输出，就是可以实时查看日志
<span class="token punctuation">-</span>t<span class="token punctuation">,</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>timestamps    显示时间戳
<span class="token punctuation">-</span><span class="token punctuation">-</span>tail              从日志的结尾显示，<span class="token punctuation">-</span><span class="token punctuation">-</span>tail=200
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul> <h2 id="其他"><a href="#其他" aria-hidden="true" class="header-anchor">#</a> 其他</h2> <h3 id="更新容器"><a href="#更新容器" aria-hidden="true" class="header-anchor">#</a> 更新容器</h3> <ul><li>当服务的配置发生更改时，可使用 docker-compose up 命令更新配置</li> <li>此时，Compose 会删除旧容器并创建新容器，新容器会以不同的 IP 地址加入网络，名称保持不变，任何指向旧容起的连接都会被关闭，重新找到新容器并连接上去</li></ul> <h3 id="links"><a href="#links" aria-hidden="true" class="header-anchor">#</a> links</h3> <p>服务之间可以使用服务名称相互访问，links 允许定义一个别名，从而使用该别名访问其它服务</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
        <span class="token key atrule">build</span><span class="token punctuation">:</span> .
        <span class="token key atrule">links</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;db:database&quot;</span>
    <span class="token key atrule">db</span><span class="token punctuation">:</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> postgres
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这样 Web 服务就可以使用 db 或 database 作为 hostname 访问 db 服务了</p> <h2 id="示例"><a href="#示例" aria-hidden="true" class="header-anchor">#</a> 示例</h2> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">nginx</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>$<span class="token punctuation">{</span>NGINX_VERSION<span class="token punctuation">}</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;${NGINX_HTTP_HOST_PORT}:80&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;${NGINX_HTTPS_HOST_PORT}:443&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> $<span class="token punctuation">{</span>SOURCE_DIR<span class="token punctuation">}</span><span class="token punctuation">:</span>/var/www/html/<span class="token punctuation">:</span>rw
      <span class="token punctuation">-</span> $<span class="token punctuation">{</span>NGINX_CONFD_DIR<span class="token punctuation">}</span><span class="token punctuation">:</span>/etc/nginx/conf.d/<span class="token punctuation">:</span>rw
      <span class="token punctuation">-</span> $<span class="token punctuation">{</span>NGINX_CONF_FILE<span class="token punctuation">}</span><span class="token punctuation">:</span>/etc/nginx/nginx.conf<span class="token punctuation">:</span>ro
      <span class="token punctuation">-</span> $<span class="token punctuation">{</span>NGINX_LOG_DIR<span class="token punctuation">}</span><span class="token punctuation">:</span>/var/log/nginx/<span class="token punctuation">:</span>rw
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> default

  <span class="token key atrule">php72</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span>
      <span class="token key atrule">context</span><span class="token punctuation">:</span> .
      <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token key atrule">PHP_VERSION</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>PHP72_VERSION<span class="token punctuation">}</span>
        <span class="token key atrule">PHP_XDEBUG</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>PHP72_XDEBUG<span class="token punctuation">}</span>
        <span class="token key atrule">PHP_SWOOLE</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>PHP72_SWOOLE<span class="token punctuation">}</span>
        <span class="token key atrule">PHP_REDIS</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>PHP72_REDIS<span class="token punctuation">}</span>
        <span class="token key atrule">REPLACE_SOURCE_LIST</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>REPLACE_SOURCE_LIST<span class="token punctuation">}</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> $<span class="token punctuation">{</span>SOURCE_DIR<span class="token punctuation">}</span><span class="token punctuation">:</span>/var/www/html/<span class="token punctuation">:</span>rw
      <span class="token punctuation">-</span> $<span class="token punctuation">{</span>PHP72_PHP_CONF_FILE<span class="token punctuation">}</span><span class="token punctuation">:</span>/usr/local/etc/php/php.ini<span class="token punctuation">:</span>ro
      <span class="token punctuation">-</span> $<span class="token punctuation">{</span>PHP72_FPM_CONF_FILE<span class="token punctuation">}</span><span class="token punctuation">:</span>/usr/local/etc/php<span class="token punctuation">-</span>fpm.d/www.conf<span class="token punctuation">:</span>rw
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">cap_add</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> SYS_PTRACE
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> default

  <span class="token key atrule">php56</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span>
      <span class="token key atrule">context</span><span class="token punctuation">:</span> .
      <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token key atrule">PHP_VERSION</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>PHP56_VERSION<span class="token punctuation">}</span>
        <span class="token key atrule">PHP_XDEBUG</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>PHP56_XDEBUG<span class="token punctuation">}</span>
        <span class="token key atrule">PHP_SWOOLE</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>PHP56_SWOOLE<span class="token punctuation">}</span>
        <span class="token key atrule">PHP_REDIS</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>PHP56_REDIS<span class="token punctuation">}</span>
        <span class="token key atrule">REPLACE_SOURCE_LIST</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>REPLACE_SOURCE_LIST<span class="token punctuation">}</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> $<span class="token punctuation">{</span>SOURCE_DIR<span class="token punctuation">}</span><span class="token punctuation">:</span>/var/www/html/<span class="token punctuation">:</span>rw
      <span class="token punctuation">-</span> $<span class="token punctuation">{</span>PHP56_PHP_CONF_FILE<span class="token punctuation">}</span><span class="token punctuation">:</span>/usr/local/etc/php/php.ini<span class="token punctuation">:</span>ro
      <span class="token punctuation">-</span> $<span class="token punctuation">{</span>PHP56_FPM_CONF_FILE<span class="token punctuation">}</span><span class="token punctuation">:</span>/usr/local/etc/php<span class="token punctuation">-</span>fpm.d/www.conf<span class="token punctuation">:</span>rw
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">cap_add</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> SYS_PTRACE
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> default

  <span class="token key atrule">mysql</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span>$<span class="token punctuation">{</span>MYSQL_VERSION<span class="token punctuation">}</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;${MYSQL_HOST_PORT}:3306&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> $<span class="token punctuation">{</span>MYSQL_CONF_FILE<span class="token punctuation">}</span><span class="token punctuation">:</span>/etc/mysql/conf.d/mysql.cnf<span class="token punctuation">:</span>ro
      <span class="token punctuation">-</span> $<span class="token punctuation">{</span>MYSQL_DATA_DIR<span class="token punctuation">}</span><span class="token punctuation">:</span>/var/lib/mysql/<span class="token punctuation">:</span>rw
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> default
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> <span class="token string">&quot;${MYSQL_ROOT_PASSWORD}&quot;</span>

  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis<span class="token punctuation">:</span>$<span class="token punctuation">{</span>REDIS_VERSION<span class="token punctuation">}</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;${REDIS_HOST_PORT}:6379&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> $<span class="token punctuation">{</span>REDIS_CONF_FILE<span class="token punctuation">}</span><span class="token punctuation">:</span>/etc/redis.conf<span class="token punctuation">:</span>ro
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">entrypoint</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;redis-server&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/etc/redis.conf&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> default
    

  <span class="token key atrule">phpmyadmin</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> phpmyadmin/phpmyadmin<span class="token punctuation">:</span>latest
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;${PHPMYADMIN_HOST_PORT}:80&quot;</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> default
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> PMA_HOST=mysql
      <span class="token punctuation">-</span> PMA_PORT=3306

  <span class="token key atrule">phpredisadmin</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> erikdubbelboer/phpredisadmin<span class="token punctuation">:</span>latest
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;${REDISMYADMIN_HOST_PORT}:80&quot;</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> default
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> REDIS_1_HOST=redis
      <span class="token punctuation">-</span> REDIS_1_PORT=6379

<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">default</span><span class="token punctuation">:</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">1 天前</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/server/docker/dockerfile.html" class="prev">Dockerfile 介绍</a></span> <span class="next"><a href="/server/vagrant/">使用 Vagrant 打造跨平台开发环境</a>→
      </span></p></div>  <div class="vcomment"><div id="vcomments"></div></div></main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.98ee12e2.js" defer></script><script src="/assets/js/5.fd13cd00.js" defer></script><script src="/assets/js/3.5d47f0b4.js" defer></script><script src="/assets/js/48.73d2336a.js" defer></script><script src="/assets/js/10.e00da3ba.js" defer></script>
  </body>
</html>
